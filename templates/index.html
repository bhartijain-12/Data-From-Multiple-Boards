<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Email Draft UI</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f7fa;
      padding: 20px;
    }
    .email-container {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      max-width: 700px;
      margin: auto;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .email-header {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 10px;
      color: #333;
    }
    .subject {
      font-weight: bold;
      margin-bottom: 15px;
      color: #222;
    }
    .email-body {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      min-height: 200px;
      background: #fafafa;
      white-space: pre-wrap;
    }
    .actions {
      margin-top: 20px;
      display: flex;
      gap: 12px;
    }
    button {
      padding: 10px 18px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      font-size: 14px;
    }
    .save {
      background: #f0ad4e;
      color: white;
    }
    .send {
      background: #28a745;
      color: white;
    }
  </style>
</head>
<body>
  <div class="email-container">
    <div class="email-header">Generated Email</div>
    <br/>
    <div class="subject" id="email-subject">
      To Email: romil.gupta@appsavio.com
    </div>
    
    <div class="subject" id="email-subject">
      Subject: Addressing Your Feedback on the Ordering Process!
    </div>
    
    <div class="email-body" id="email-body" contenteditable="true">
Hi Tanisha Sharma,
      
Thank you for sharing your feedback regarding the bulk ordering process. I sincerely apologize for the inconvenience you experienced; itâ€™s important to us that our customers have a smooth and efficient experience.

To address your concerns, we will take the following steps:
- Review the current bulk ordering process to identify pain points.
- Simplify the steps involved in placing bulk orders.
- Provide clear instructions and support for customers during the ordering process.
- Gather feedback from customers after implementing changes to ensure satisfaction.

We appreciate your patience as we work to improve our services. Please feel free to reach out if you have any further questions or concerns.

Warm regards,
[Your Companyâ€™s Support Team]
    </div>

    <div class="actions">
      <button class="save" onclick="saveDraft()">ðŸ’¾ Save as Draft</button>
      <button class="send" onclick="sendEmail()">ðŸ“¨ Send</button>
    </div>
  </div>

  <script>
    const API_URL = "https://api.monday.com/v2";
    const API_KEY = "eyJhbGciOiJIUzI1NiJ9.eyJ0aWQiOjUxODE2ODIyNiwiYWFpIjoxMSwidWlkIjo3NjM1NTU1NCwiaWFkIjoiMjAyNS0wNS0yN1QxMTo1MTozOC4wMDBaIiwicGVyIjoibWU6d3JpdGUiLCJhY3RpZCI6Mjk2NTAyMjEsInJnbiI6ImFwc2UyIn0.4x5sOTNa8-gYQ9Fb8Lnv8hh2_XQXVYJkhxlfRlUmt0s"; // Replace with your Monday API key
    const BOARD_ID = "2052800885";     // Replace with your board_id
    const ITEM_ID = "2053389548";     // Replace with your item_id
    const COLUMN_ID = "long_text_mktxzx31"; // Replace with your column_id

     // Escape helper
    function escapeGraphQLString(str) {
      if (!str) return "";
      return str
        .replace(/\\/g, "\\\\")   // escape backslashes
        .replace(/"/g, '\\"')     // escape double quotes
        .replace(/\n/g, "\\n")    // escape newlines
        .replace(/\r/g, "\\r");   // escape carriage returns
    }
    
    async function callMondayAPI(query) {
      const response = await fetch(API_URL, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": API_KEY
        },
        body: JSON.stringify({ query })
      });
      return response.json();
    }

    async function saveDraft() {
      const body = document.getElementById("email-body").innerText;
      const escapedBody = escapeGraphQLString(body);
      const query = `
        mutation {
          change_simple_column_value (
            board_id: ${BOARD_ID},
            item_id: ${ITEM_ID},
            column_id: "${COLUMN_ID}",
            value: "${escapedBody}"
          ) {
            id
          }
        }
      `;

      const result = await callMondayAPI(query);
      console.log("Save Draft result:", result);
      alert("Draft saved âœ…");
      window.close();
    }

    async function sendEmail() {
      const body = document.getElementById("email-body").innerText;
      const escapedBody = escapeGraphQLString(body);

      const query = `
        mutation {
          change_simple_column_value (
            board_id: ${BOARD_ID},
            item_id: ${ITEM_ID},
            column_id: "${COLUMN_ID}",
            value: "${escapedBody}"
          ) {
            id
          }
        }
      `;

      const result = await callMondayAPI(query);
      console.log("Send Email result:", result);

      // Here you could also update another column (e.g., "send_to_customer" field)
      alert("Email sent to customer ðŸš€");
      window.close();
    }
  </script>
</body>
</html>
